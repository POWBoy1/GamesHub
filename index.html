<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Home</title>
  <link rel="icon" type="image/x-icon" href="assets/GoogleClassroomIcon.ico">
  <style>
    body {
      margin: 0;
      font-family: Arial, sans-serif;
      background: #fff;
      display: flex;
      flex-direction: column;
      min-height: 100vh;
    }

    /* Header / Top Bar */
    header {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      background: #2c7be5;
      color: white;
      padding: 15px;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 20px;
      font-weight: bold;
      z-index: 1000;
      transition: opacity 0.3s ease;
    }

    header img {
      height: 24px;
      vertical-align: middle;
      margin-right: 8px;
    }

    .back-button {
      position: fixed;
      top: 12px;
      left: 10px;
      background: red;
      border: none;
      padding: 6px 12px;
      border-radius: 6px;
      cursor: pointer;
      color: white;
      font-weight: bold;
      display: none;
      z-index: 9999;
    }

    /* Games menu grid */
    .games-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: 20px;
      padding: 100px 20px 80px;
      flex: 1;
    }

    .game-card {
      background: white;
      border-radius: 10px;
      overflow: hidden;
      box-shadow: 0 4px 6px rgba(0,0,0,0.1);
      cursor: pointer;
      transition: transform 0.2s;
      display: flex;
      flex-direction: column;
    }

    .game-card:hover {
      transform: scale(1.05);
    }

    .game-thumbnail {
      width: 100%;
      height: 150px;
      object-fit: cover;
    }

    .game-info {
      display: flex;
      align-items: center;
      padding: 10px;
    }

    .game-info img {
      width: 24px;
      height: 24px;
      margin-right: 10px;
    }

    /* Game Screen */
    .game-screen {
      display: none;
      flex: 1;
      justify-content: center;
      align-items: center;
      background: white;
      padding-top: 80px;
      padding-bottom: 60px;
    }

    .game-container {
      background: white;
      border: 12px solid #2c7be5;
      border-radius: 24px;
      width: 80%;
      max-width: 1200px;
      aspect-ratio: 16/9;
      position: relative;
      display: flex;
      justify-content: center;
      align-items: center;
      overflow: hidden;
    }

    iframe {
      width: 100%;
      height: 100%;
      border: none;
      border-radius: 12px;
      display: none;
    }

    .overlay {
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      display: flex;
      justify-content: center;
      align-items: center;
      background: rgba(0,0,0,0.4);
      color: white;
      font-size: 24px;
      font-weight: bold;
      cursor: pointer;
      border-radius: 12px;
      z-index: 5;
      text-shadow: 1px 1px 4px black;
    }

    /* Loading overlay */
    .loading-overlay {
      position: absolute;
      top: 0; left: 0; right: 0; bottom: 0;
      background: rgba(0,0,0,0.8);
      display: none;
      flex-direction: column;
      justify-content: center;
      align-items: center;
      color: white;
      font-size: 18px;
      z-index: 10;
    }

    .spinner {
      border: 6px solid #f3f3f3;
      border-top: 6px solid #2c7be5;
      border-radius: 50%;
      width: 50px;
      height: 50px;
      animation: spin 1s linear infinite;
      margin-bottom: 15px;
    }

    @keyframes spin {
      0% { transform: rotate(0deg); }
      100% { transform: rotate(360deg); }
    }

    /* Fullscreen Button floating on game */
    .fullscreen-btn {
      position: absolute;
      bottom: -40px;
      right: 20px;
      background: #2c7be5;
      color: white;
      padding: 10px 18px;
      border-radius: 20px;
      border: none;
      cursor: pointer;
      font-size: 14px;
      font-weight: bold;
    }

    footer {
      background: #2c7be5;
      color: white;
      text-align: center;
      padding: 12px;
      position: fixed;
      bottom: 0;
      left: 0;
      width: 100%;
      z-index: 1000;
      font-weight: bold;
      transition: opacity 0.3s ease;
    }

    .hidden {
      opacity: 0;
      pointer-events: none;
    }
  </style>
</head>
<body>
<header id="mainHeader">
  <button class="back-button" id="backButton" onclick="backToHub()">‚¨Ö Back</button>
  üéÆ POWBoy1‚Äôs Game Hub üéÆ
</header>

<div id="mainMenu" class="games-grid"></div>

<div id="gameScreen" class="game-screen">
  <div class="game-container">
    <div id="iframeOverlay" class="overlay">‚ñ∂ Play</div>
    <div id="loadingOverlay" class="loading-overlay">
      <div class="spinner"></div>
      Loading Please Wait...
    </div>
    <iframe id="gameFrame"></iframe>
    <button onclick="toggleFullscreen()" id="fullscreenBtn" class="fullscreen-btn">‚õ∂ Fullscreen</button>
  </div>
</div>

<footer id="mainFooter">Made by POWBoy1</footer>

<script>
const placeholderIcon = "assets/holder-icon.png";
const placeholderThumb = "assets/holder-thumb.png";

const mainMenu = document.getElementById("mainMenu");
const gameScreen = document.getElementById("gameScreen");
const gameFrame = document.getElementById("gameFrame");
const iframeOverlay = document.getElementById("iframeOverlay");
const loadingOverlay = document.getElementById("loadingOverlay");
const mainHeader = document.getElementById("mainHeader");
const backButton = document.getElementById("backButton");
const mainFooter = document.getElementById("mainFooter");
const fullscreenBtn = document.getElementById("fullscreenBtn");

// üîó Fetch games.json
fetch("https://raw.githubusercontent.com/POWBoy1/GameHubUpdater/refs/heads/main/games.json")
  .then(res => res.json())
  .then(games => renderGames(games))
  .catch(err => {
    console.error("Failed to load games.json:", err);
    mainMenu.innerHTML = "<p style='color:red'>Failed to load game list.</p>";
  });

function renderGames(games) {
  games.forEach(game => {
    const card = document.createElement("div");
    card.className = "game-card";
    card.innerHTML = `
      <img class="game-thumbnail" src="${game.thumbnail || placeholderThumb}" alt="${game.title}" onerror="this.src='${placeholderThumb}'">
      <div class="game-info">
        <img src="${game.icon || placeholderIcon}" alt="${game.title} icon" onerror="this.src='${placeholderIcon}'">
        <h3>${game.title}</h3>
      </div>
    `;
    card.addEventListener("click", () => openGame(game));
    mainMenu.appendChild(card);
  });
}

function openGame(game) {
  gameScreen.style.display = "flex";
  mainMenu.style.display = "none";
  backButton.style.display = "block";

  // Update header
  mainHeader.innerHTML = '';
  mainHeader.appendChild(backButton);

  const icon = document.createElement('img');
  icon.src = game.icon || placeholderIcon;
  icon.alt = game.title + ' icon';
  icon.style.height = '24px';
  icon.style.verticalAlign = 'middle';
  icon.style.marginRight = '8px';

  const title = document.createElement('span');
  title.textContent = game.title;

  mainHeader.appendChild(icon);
  mainHeader.appendChild(title);

  // Overlay background
  iframeOverlay.style.background = `
    linear-gradient(rgba(0,0,0,0.4), rgba(0,0,0,0.4)),
    url('${game.thumbnail}') center/cover no-repeat
  `;
  iframeOverlay.style.display = "flex";
  iframeOverlay.textContent = "‚ñ∂ Play";

  // Prepare iframe but don't load
  gameFrame.src = "";
  gameFrame.style.display = "block";
  loadingOverlay.style.display = "none";

  // Click to play
  iframeOverlay.onclick = () => {
    iframeOverlay.style.display = "none";
    loadingOverlay.style.display = "flex";
    gameFrame.src = game.url;
    gameFrame.onload = () => {
      loadingOverlay.style.display = "none";
    };
  };
}

function backToHub() {
  gameScreen.style.display = "none";
  mainMenu.style.display = "grid";
  gameFrame.src = "";
  gameFrame.style.display = "none";
  iframeOverlay.style.display = "none";
  loadingOverlay.style.display = "none";
  backButton.style.display = "none";
  mainHeader.innerHTML = "üéÆ POWBoy1‚Äôs Game Hub üéÆ";
  if (document.fullscreenElement) document.exitFullscreen();
}

function toggleFullscreen() {
  if (!document.fullscreenElement) {
    gameFrame.requestFullscreen();
  } else {
    document.exitFullscreen();
  }
}

document.addEventListener("fullscreenchange", () => {
  if (document.fullscreenElement === gameFrame) {
    mainHeader.classList.add("hidden");
    mainFooter.classList.add("hidden");
    backButton.classList.add("hidden");
    fullscreenBtn.textContent = "‚ùå Exit Fullscreen";
  } else {
    mainHeader.classList.remove("hidden");
    mainFooter.classList.remove("hidden");
    backButton.classList.remove("hidden");
    fullscreenBtn.textContent = "‚õ∂ Fullscreen";
  }
});
</script>
</body>
</html>
